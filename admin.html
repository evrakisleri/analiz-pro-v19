<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Analiz Pro v19 - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-10">
  <div class="max-w-md mx-auto bg-gray-800 p-8 rounded-xl shadow-2xl">
    <h1 class="text-2xl font-bold mb-6 text-green-500">Sistem Yönetim Paneli</h1>
    <div class="space-y-4">
      <input id="okul" placeholder="Okul Adı" class="w-full p-3 bg-gray-700 rounded">
      <input id="email" placeholder="Müdür E-posta" class="w-full p-3 bg-gray-700 rounded">
      <input id="sifre" type="password" placeholder="Müdür Şifre" class="w-full p-3 bg-gray-700 rounded">
      <button id="btnKur" class="w-full bg-green-600 p-3 rounded font-bold hover:bg-green-700">SİSTEMİ KUR</button>
    </div>
    <div id="durum" class="mt-4 text-center text-sm"></div>
  </div>

  <script type="module">
    import { supabase } from './benimsupabase/supabaseClient.js';

    document.getElementById('btnKur').onclick = async () => {
      const okul = document.getElementById('okul').value.trim();
      const email = document.getElementById('email').value.trim();
      const sifre = document.getElementById('sifre').value.trim();
      const durum = document.getElementById('durum');

      if (!okul || !email || !sifre) return alert("Tüm alanları doldur!");

      durum.innerHTML = "İşleniyor...";

      try {
        const { error: authErr } = await supabase.auth.signUp({ email, password: sifre });
        if (authErr) throw authErr;

        const { error: rpcErr } = await supabase.rpc('kur_sistemi', { 
          okul_adi: okul, 
          mudur_email: email 
        });
        if (rpcErr) throw rpcErr;

        durum.innerHTML = "✅ Sistem başarıyla kuruldu!";
      } catch (err) {
        durum.innerHTML = "❌ Hata: " + err.message;
      }
    };
  </script>
</body>
</html>
