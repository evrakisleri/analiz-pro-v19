<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Analiz Pro v19 - Giriş</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#05080f] text-white flex items-center justify-center min-h-screen">
  <div class="bg-[#0a0f1a] p-10 rounded-[2.5rem] border border-slate-800 w-full max-w-md shadow-2xl text-center">
    <h1 class="text-2xl font-black text-blue-500 mb-8 italic uppercase tracking-widest">ANALİZ PRO V19</h1>
    <div class="space-y-4">
      <input type="email" id="email" placeholder="E-posta" class="w-full bg-[#e8f0fe] p-4 rounded-xl text-black outline-none border-none">
      <input type="password" id="pass" placeholder="Şifre" class="w-full bg-black border border-slate-800 p-4 rounded-xl text-white outline-none focus:border-blue-500 transition-all">
      <button onclick="login()" id="btn" class="w-full bg-[#2563eb] py-4 rounded-xl font-bold uppercase hover:bg-blue-600 transition-all active:scale-95">SİSTEME BAĞLAN</button>
      <p id="msg" class="text-[10px] font-bold uppercase mt-4 text-slate-500">Durum: Frankfurt Bekleniyor</p>
    </div>
  </div>

  <script type="module">
    import { supabase } from './supabaseClient.js'

    async function login() {
      const email = document.getElementById('email').value.trim()
      const password = document.getElementById('pass').value
      const msg = document.getElementById('msg')
      const btn = document.getElementById('btn')

      msg.innerText = "⏳ Frankfurt onaylıyor..."
      msg.style.color = "#3b82f6"
      btn.disabled = true

      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password })
        if (error) throw error

        const authId = data.user.id

        // Ek bilgileri çek
        const { data: userInfo } = await supabase
          .from('users')
          .select('*')
          .eq('auth_id', authId)
          .single()

        // LocalStorage ile admin.html'e taşı
        localStorage.setItem('userInfo', JSON.stringify(userInfo))

        msg.innerText = "✅ Başarılı! Panel açılıyor..."
        msg.style.color = "#4ade80"

        setTimeout(() => { window.location.href = 'admin.html' }, 1000)

      } catch (err) {
        msg.innerText = "❌ HATA: " + err.message
        msg.style.color = "#f87171"
        btn.disabled = false
        console.error(err)
      }
    }

    window.login = login
  </script>
</body>
</html>
