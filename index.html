<script type="module">
    import { supabase } from './supabaseClient.js';

    window.login = async () => {
        const email = document.getElementById('email').value.trim();
        const pass = document.getElementById('pass').value;
        const msg = document.getElementById('msg');

        msg.innerText = "⏳ BAĞLANILIYOR...";

        const { data, error } = await supabase.auth.signInWithPassword({ email, password: pass });

        if (error) {
            msg.innerText = "❌ HATA: " + error.message.toUpperCase();
            return;
        }

        // Rolü kontrol et
        const { data: profile } = await supabase.from('users').select('role').eq('email', email).single();

        if (profile?.role === 'admin') {
            window.location.href = 'admin.html';
        } else if (profile?.role === 'teacher') {
            window.location.href = 'teacher.html';
        } else {
            window.location.href = 'student.html';
        }
    };
</script>
