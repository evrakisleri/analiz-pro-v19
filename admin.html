<!DOCTYPE html>
<html lang="tr">
<head>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#050505] text-white p-10 min-h-screen">
    <div class="max-w-5xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-blue-500">ANALİZ PRO v19 - YÖNETİM MERKEZİ</h1>
        <div class="bg-gray-900/50 backdrop-blur-md p-6 rounded-2xl border border-gray-800">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="text-gray-400 border-b border-gray-800">
                        <th class="p-4">Kullanıcı Adı</th>
                        <th class="p-4">Sınıf/Şube</th>
                        <th class="p-4">Rol Yönetimi</th>
                        <th class="p-4">İşlem</th>
                    </tr>
                </thead>
                <tbody id="userTable">
                    </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { supabase } from './supabaseClient.js';

        async function loadUsers() {
            const { data, error } = await supabase.from('profiles').select('*');
            if (error) { alert("Veri çekilemedi: " + error.message); return; }
            
            const tbody = document.getElementById('userTable');
            tbody.innerHTML = data.map(u => `
                <tr class="border-b border-gray-800 hover:bg-gray-800/50 transition">
                    <td class="p-4">${u.full_name || 'İsimsiz Kullanıcı'}</td>
                    <td class="p-4">${u.class_branch || '-'}</td>
                    <td class="p-4">
                        <select onchange="updateRole('${u.id}', this.value)" class="bg-black border border-gray-700 p-1 rounded text-sm">
                            <option value="student" ${u.role === 'student' ? 'selected' : ''}>Öğrenci</option>
                            <option value="principal" ${u.role === 'principal' ? 'selected' : ''}>Müdür</option>
                            <option value="admin" ${u.role === 'admin' ? 'selected' : ''}>Admin</option>
                        </select>
                    </td>
                    <td class="p-4">
                        <button onclick="deleteUser('${u.id}')" class="text-red-500 hover:text-red-300 font-bold">SİL</button>
                    </td>
                </tr>
            `).join('');
        }

        window.updateRole = async (id, role) => {
            await supabase.from('profiles').update({ role }).eq('id', id);
        };

        window.deleteUser = async (id) => {
            if(confirm("Bu kullanıcı kalıcı olarak silinecek!")) {
                await supabase.from('profiles').delete().eq('id', id);
                loadUsers();
            }
        };

        loadUsers();
    </script>
</body>
</html>
